<!doctype html>
<html class="no-js" lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorate="~{/layout/layout}">
<head>

</head>
<body>

<div id="content" layout:fragment="content">
    <!-- breadcrumb start -->
    <div class="breadcrumb-area">
        <div class="container">
            <ol class="breadcrumb">
                <li><a href="index.html"><i class="fa fa-home"></i> Home</a></li>
                <li class="active">Cart</li>
            </ol>
        </div>
    </div>
    <!-- breadcrumb end -->
    <!-- cart-main-area start -->
    <div class="cart-main-area pt-0">

        <section class="cartMain">
            <div class="cartMain_hd">
                <ul class="order_lists cartTop">
                    <li class="list_chk">
                        <!--所有商品全选-->
                        <input type="checkbox" id="all" class="whole_check">
                        <label for="all"></label>
                        全选
                    </li>
                    <li class="list_con">商品信息</li>
                    <li class="list_info">作者</li>
                    <li class="list_price">单价</li>
                    <li class="list_amount">数量</li>
                    <li class="list_sum">金额</li>
                    <li class="list_op">操作</li>
                </ul>
            </div>

            <div class="cartBox">
                <div class="shop_info">
                    <div class="all_check">
                        <!--店铺全选-->
                        <input type="checkbox" id="shop_a" class="shopChoice">
                        <label for="shop_a" class="shop"></label>
                    </div>
                    <div class="shop_name" th:unless="${#lists.isEmpty(shops)}" th:text="${shops[0].sellStore}">
                        店铺：<a href="javascript:;">搜猎人艺术生活</a>
                    </div>
                </div>
                <div class="order_content">
                    <ul class="order_lists" th:each="shop:${shops}">
                        <li class="list_chk">
                            <input type="checkbox" th:id="checkbox_+${shop.cartId}" id="checkbox_2" class="son_check">
                            <label th:for="checkbox_+${shop.cartId}" for="checkbox_2"></label>
                        </li>
                        <li class="list_con">
                            <div class="list_img"><a href="javascript:;">
                                <img th:unless="${#lists.isEmpty(shop.pictureContent)}"
                                     th:src="${shop.pictureContent[0].pictureContent}"
                                     src="/img/product/1.jpg" alt="" style="width: 90px;height:90px;"/>
                                <img th:if="${#lists.isEmpty(shop.pictureContent)}"
                                     src="https://i.loli.net/2019/05/29/5cee3e7b28f3095703.jpg"
                                     alt=""/>
                            </a></div>
                            <div class="list_text">
                                <br>
                                <a href="javascript:;" th:text="${shop.bookName}"
                                   style="padding-left: 40%;">书名</a></div>
                        </li>
                        <li class="list_info">
                            <br>
                            <p th:text="${shop.author}">尺寸：16*16*3(cm)</p>
                        </li>
                        <li class="list_price">
                            <p class="price" th:text="￥+${shop.bookPrice}"> ￥980</p>
                        </li>
                        <li class="list_amount">
                            <div class="amount_box">
                                <input type="hidden" th:value="${shop.cartId}">
                                <a href="javascript:;" class="reduce" onclick="subCount(this)">-</a>
                                <input type="text" th:value="${shop.count}" class="sum">
                                <a href="javascript:;" class="plus" onclick="addCount(this)">+</a>
                            </div>
                        </li>
                        <li class="list_sum">
                            <p class="sum_price" th:text="￥+${shop.bookPrice}"></p>
                        </li>
                        <li class="list_op">
                            <input type="hidden" th:value="${shop.cartId}">
                            <p class="del"><a href="javascript:;" class="delBtn" onclick="getCartId(this)">移除商品</a></p>
                        </li>
                    </ul>

                </div>
            </div>
            <div th:text="${msg}" style="color:red; margin-left: 45%"></div>

            <!--底部-->
            <div class="bar-wrapper">
                <div class="bar-right">
                    <div class="piece">已选商品<strong class="piece_num">0</strong>件</div>
                    <div class="totalMoney">共计: <strong class="total_text">0.00</strong></div>
                    <div class="calBtn"><a href="javascript:;">结算</a></div>
                </div>
            </div>
        </section>
        <section class="model_bg" style="height: 2100px;"></section>
        <section class="my_model">
            <p class="title">删除宝贝<span class="closeModel">X</span></p>
            <p>您确认要删除该宝贝吗？</p>
            <div class="opBtn"><a href="javascript:;" class="dialog-sure" onclick="delCart()">确定</a><a
                    href="javascript:;"
                    class="dialog-close">关闭</a>
            </div>
        </section>


    </div>
    <!-- cart-main-area end -->

</div>

<script layout:fragment="script">
    var config = {pageTitle: "购物车", navActive: "navProduct"};
    var cartId = 0;
    $(function () {
        document.title = config.pageTitle;
        $("#" + config.navActive).addClass("active");
    });

    function getCartId(e) {
        cartId = $(e).parent().parent().children("input:first").val();
    }

    function delCart() {
        $.ajax({
            type: "post",
            url: "/book/delCart",
            data: {
                cartId: cartId
            },
            dataType: "json",
            success: function (json) {

            }
        });
    }

    function updateCount(carId, count) {
        $.ajax({
            type: "post",
            url: "/book/updateCount",
            data: {
                cartId: carId,
                count: count
            },
            dataType: "json",
            success: function (json) {

            }
        });
    }

    function subCount(e) {
        var count = $(e).parent().children("input:last").val();
        count--;
        var carId = $(e).parent().children("input:first").val();
        if (count === 0) {
            count = 1;
        }
        updateCount(carId, count);
    }

    function addCount(e) {
        var count = $(e).parent().children("input:last").val();
        count++;
        var carId = $(e).parent().children("input:first").val();
        updateCount(carId, count);
    }
</script>
</body>
</html>

